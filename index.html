<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Finished Weekly Schedule</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#f4f7fa;--text:#222;--table-bg:#fff;--day-bg:#e9f0ff;--border:#d1d9e6;--loc:#2f6cb0;--primary:#4361ee;--secondary:#3a0ca3;--card-shadow:0 4px 12px rgba(0,0,0,0.08);}
.dark{--bg:#121212;--text:#f2f2f2;--table-bg:#1e1e1e;--day-bg:#2d2d2d;--border:#444;--loc:#8ab4f8;--primary:#5e72e4;--secondary:#825ee4;--card-shadow:0 4px 12px rgba(0,0,0,0.3);}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;padding:16px;transition:all 0.3s ease;}
.container{max-width:1200px;margin:0 auto;}
.header{display:flex;flex-direction:column;margin-bottom:24px;gap:16px;}
.header-top{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;}
.header h1{font-size:1.75rem;font-weight:700;color:var(--primary);margin:0;}
.header-message{font-size:0.95rem;color:var(--secondary);font-weight:600;}
.buttons-container{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;}
.btn{padding:10px 16px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:0.875rem;transition:all 0.2s ease;display:flex;align-items:center;gap:6px;box-shadow:0 2px 4px rgba(0,0,0,0.1);}
.btn:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.15);}
.btn:active{transform:translateY(0);}
.btn-icon{font-size:1rem;}
#toggleMode,#printBtn{background:var(--primary);color:#fff;}
#excelBtn{background:#28a745;color:#fff;}
#saveBtn,#loadBtn,#resetBtn{display:none;}
#saveBtn{background:#ff9900;color:#fff;}
#loadBtn{background:#6c757d;color:#fff;}
#docxBtn{background:#6f42c1;color:#fff;}
#adminBtn{background:#ff5722;color:#fff;}
#resetBtn{background:#dc3545;color:#fff;}
.table-container{overflow-x:auto;border-radius:12px;box-shadow:var(--card-shadow);margin-bottom:24px;background:var(--table-bg);}
table{width:100%;border-collapse:collapse;background:var(--table-bg);min-width:600px;}
th,td{border:1px solid var(--border);padding:12px;text-align:center;transition:background-color 0.2s;}
th{background-color:var(--primary);color:white;font-weight:600;font-size:0.9rem;}
.day{background:var(--day-bg);font-weight:700;font-size:1rem;}
.members{white-space:pre-line;text-align:left;}
.loc{font-weight:600;color:var(--loc);}
.time{font-weight:600;}
@media(max-width:768px){body{padding:12px}.header-top{flex-direction:column;align-items:stretch}.header h1{text-align:center;font-size:1.5rem}.buttons-container{justify-content:center}.btn{flex:1;min-width:120px;justify-content:center;padding:12px 8px;font-size:0.8rem}th,td{padding:8px 6px;font-size:0.85rem}.day{font-size:0.9rem}}
@media(max-width:480px){.btn{min-width:100px;padding:10px 6px;font-size:0.75rem}th,td{padding:6px 4px;font-size:0.8rem}.header h1{font-size:1.3rem}}
@media print{button{display:none}.table-container{box-shadow:none}body{background:white;color:black;padding:0}.header{display:none}}
tr:hover td{background-color:rgba(0,0,0,0.03)}
.dark tr:hover td{background-color:rgba(255,255,255,0.05)}
.worktile{background:var(--table-bg);color:var(--text);padding:16px;border-radius:12px;box-shadow:var(--card-shadow);margin-top:16px;max-width:600px;margin-left:auto;margin-right:auto;}
.worktile h3{margin-bottom:12px;color:var(--primary);font-size:1.2rem;text-align:center;}
.worktile ul{list-style:disc inside;padding-left:0;}
.worktile li{margin-bottom:6px;font-size:0.95rem;line-height:1.4;}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="header-top">
      <h1>Ultimate Weekly Schedule</h1>
      <div class="header-message" id="headerMessage"></div>
      <div class="buttons-container">
        <button id="toggleMode" class="btn"><span class="btn-icon">üåô</span> Dark Mode</button>
        <button id="printBtn" class="btn"><span class="btn-icon">üìÑ</span> PDF</button>
        <button id="excelBtn" class="btn"><span class="btn-icon">üìä</span> Excel</button>
        <button id="docxBtn" class="btn"><span class="btn-icon">üìù</span> DOCX</button>
        <button id="saveBtn" class="btn">üíæ Save</button>
        <button id="loadBtn" class="btn">üìÇ Load</button>
        <button id="resetBtn" class="btn">üóëÔ∏è Reset</button>
        <button id="adminBtn" class="btn">üîë Admin Login</button>
      </div>
    </div>
  </div>

  <div class="worktile">
      <h3>·ã® ·å∏·àé·âµ ·à™·ä¢·àµ</h3>
      <ul>
          <li style="color: #28a745">See below schedules</li>
      </ul>
  </div>

  <div class="table-container">
    <table id="scheduleTable">
      <tr><th>Day</th><th>Group</th><th>Members</th><th>Location</th><th>Time</th></tr>
    </table>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/docx@8.2.1/build/docx.umd.js"></script>

<script>
const days=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
let defaultMemberData={
"Monday":[["Bemnet 0915011889","Piniel"],["Abraham 0941428585","Biniam"],["Miretu","Yordanos 3rd yr 0938692337"]],
"Tuesday":[["Lelise","Maria 0963650837","Biyan"],["Mitiku","Sisay 0975913583"],["Abaduba 0940282603","Mebratu"]],
"Wednesday":[["Wube 0916209783","Tarekech 0942492938"],["Ribka","Hayu 0935335590"],["Habte 0903994920","Dawit 0985380211"]],
"Thursday":[["Mahi 0912602707","Tinsae 0931781627"],["Niftalem 0961230890","Jiregna"],["Semere 0938544363","Asahegn"]],
"Friday":[["Mercy","Saron 0972952052"],["Sala","Mastewal 0955830155"],["Nahom 0907236139","Temesgen 0939070194"]],
"Saturday":[["Jery 0987868963","Sebontu 0968720938"],["Gaera 0993484369","Hundesa 0918518385"],["Linken 0941432966","Amanuel 0952079638"]],
"Sunday":[["Mekilt","Ruhama 0903203903"],["Robi 0939395469","Yordanos 0938692337"],["Aben","Melkamu"]]
};
const locations=["üè† Female Dorm - Stadium","üìù Register - Block 28","üè† Male Dorm"];
const timeSlots=["12:00 - 12:40","12:00 - 12:40","12:00 - 12:40"];
const table=document.getElementById("scheduleTable");
const admins=[
{name:"Admin1",password:"pass1"},
{name:"Admin2",password:"pass2"},
{name:"Admin3",password:"pass3"},
{name:"Admin4",password:"pass4"},
{name:"Admin5",password:"pass5"}
];
let isAdmin=false;

function loadTable(source=defaultMemberData){
    table.innerHTML=`<tr><th>Day</th><th>Group</th><th>Members</th><th>Location</th><th>Time</th></tr>`;
    days.forEach(day=>{
        const groups=source[day];
        if(!groups) return;
        groups.forEach((grp,idx)=>{
            const row=table.insertRow(-1);
            if(idx===0){
                const dayCell=row.insertCell(0);
                dayCell.rowSpan=groups.length;
                dayCell.className="day";
                dayCell.innerText=day;
            }
            row.insertCell(-1).innerText=idx+1;
            const memberCell=row.insertCell(-1);
            memberCell.className="members";
            memberCell.innerHTML=grp.members? grp.members.join("\n") : grp.join("\n");
            const locCell=row.insertCell(-1);
            locCell.className="loc";
            locCell.innerText=grp.location ? grp.location : locations[idx];
            const timeCell=row.insertCell(-1);
            timeCell.className="time";
            timeCell.innerText=grp.time ? grp.time : timeSlots[idx];
        });
    });
    applyEditable();
}

function applyEditable(){
    table.querySelectorAll("tr").forEach((row,i)=>{
        if(i===0) return;
        row.querySelectorAll(".members,.loc,.time").forEach(cell=>{
            cell.contentEditable=isAdmin;
            cell.oninput=isAdmin?()=>updateJSData():null;
        });
    });
}

function updateJSData(){
    let rowIndex = 1;
    days.forEach(day => {
        defaultMemberData[day] = [];
        for (let i = 0; i < 3; i++) {
            const row = table.rows[rowIndex];
            if (!row) continue;
            const members = row.querySelector(".members").innerText.split("\n").filter(x => x.trim()!=="");
            const location = row.querySelector(".loc").innerText.trim();
            const time = row.querySelector(".time").innerText.trim();
            defaultMemberData[day].push({members, location, time});
            rowIndex++;
        }
    });
}

document.getElementById("adminBtn").onclick = () => {
    const password = prompt("Enter admin password:");
    const admin = admins.find(a => a.password === password);
    if (admin) {
        isAdmin = true;
        sessionStorage.setItem("isAdmin", "true");
        sessionStorage.setItem("adminName", admin.name);
        document.getElementById("headerMessage").innerText = `Welcome ${admin.name}`;
        applyEditable();
        document.getElementById("saveBtn").style.display = "flex";
        document.getElementById("loadBtn").style.display = "flex";
        document.getElementById("resetBtn").style.display = "flex";
        alert(`Welcome ${admin.name}, you can now edit all cells!`);
    } else {
        alert("Incorrect password. Table remains read-only.");
    }
};

window.onload = () => {
    if (sessionStorage.getItem("isAdmin") === "true") {
        isAdmin = true;
        document.getElementById("headerMessage").innerText = `Welcome ${sessionStorage.getItem("adminName")}`;
        document.getElementById("saveBtn").style.display = "flex";
        document.getElementById("loadBtn").style.display = "flex";
        document.getElementById("resetBtn").style.display = "flex";
    }
    const saved = localStorage.getItem("weeklySchedule");
    if (saved) {
        defaultMemberData = JSON.parse(saved);
        loadTable(defaultMemberData);
    } else loadTable();
};

document.getElementById("saveBtn").onclick = () => {
    if (!isAdmin) { alert("Only admins can save!"); return; }
    const data = {};
    let rowIndex = 1;
    days.forEach(day => {
        data[day] = [];
        for (let i = 0; i < 3; i++) {
            const row = table.rows[rowIndex];
            if (!row) continue;
            const members = row.querySelector(".members").innerText.split("\n").filter(x => x.trim()!=="");
            const location = row.querySelector(".loc").innerText.trim();
            const time = row.querySelector(".time").innerText.trim();
            data[day].push({members, location, time});
            rowIndex++;
        }
    });
    localStorage.setItem("weeklySchedule", JSON.stringify(data));
    alert("Schedule saved!");
};

document.getElementById("loadBtn").onclick = () => {
    if(!isAdmin){ alert("Only admins can load!"); return; }
    const saved = localStorage.getItem("weeklySchedule");
    if(saved){ loadTable(JSON.parse(saved)); alert("Schedule loaded."); }
    else { alert("No saved schedule found. Loading default."); loadTable(); }
};

document.getElementById("resetBtn").onclick = () => {
    if(!isAdmin){ alert("Only admins can reset!"); return; }
    if(confirm("Are you sure you want to reset all saved data?")){
        localStorage.removeItem("weeklySchedule");
        loadTable();
        alert("Local storage cleared. Default schedule loaded.");
    }
};

document.getElementById("toggleMode").onclick = () => {
    document.body.classList.toggle("dark");
    document.getElementById("toggleMode").innerHTML=document.body.classList.contains("dark")?'<span class="btn-icon">‚òÄÔ∏è</span> Light Mode':'<span class="btn-icon">üåô</span> Dark Mode';
};

document.getElementById("printBtn").onclick=()=>window.print();

document.getElementById("excelBtn").onclick=()=>{ 
    const wb=XLSX.utils.table_to_book(table,{sheet:"Weekly Schedule"});
    XLSX.writeFile(wb,"Weekly_Schedule.xlsx");
};

document.getElementById("docxBtn").onclick=()=>{ 
    const {Document,Packer,Paragraph,Table,TableRow,TableCell}=window.docx;
    const rows=[];
    for(let r=0;r<table.rows.length;r++){
        const cells=[];
        for(let c=0;c<table.rows[r].cells.length;c++){
            cells.push(new TableCell({children:[new Paragraph({text:table.rows[r].cells[c].innerText})]}));
        }
        rows.push(new TableRow({children:cells}));
    }
    const doc=new Document({sections:[{children:[new Paragraph({text:"Weekly Schedule",heading:"Heading1"}),new Table({rows})]}]});
    Packer.toBlob(doc).then(blob=>{
        const url=URL.createObjectURL(blob);
        const a=document.createElement("a");
        a.href=url;a.download="Weekly_Schedule.docx";document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);
    });
};
</script>
</body>
</html>
